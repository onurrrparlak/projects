<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
        }

        #sidebarFrame {
            width: 250px;
            /* Adjust the width of the sidebar */
            height: 100vh;
            /* Full height of the viewport */
            position: fixed;
            top: 0;
            left: 0;
            border: none;
        }

        #container {
            flex: 1;
            height: 100vh;
            margin-left: 250px;
            /* Same width as the sidebar */
            overflow-y: auto;
            /* Enable scrolling for content */
            padding: 20px;
            /* Adjust padding as needed */
        }
    </style>

    <title>Yeni Film Ekle</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

</head>

<body>
    <iframe id="sidebarFrame" src="sidebar.html"></iframe>

    <div class="container">
        <h1>Yeni Film Ekle</h1>
        <form id="addMovieForm">
            <div class="form-group">
                <label for="newMovieId">Film ID:</label>
                <input type="text" class="form-control" id="newMovieId" name="newMovieId">
            </div>
            <div class="form-group">
                <label for="newTitle">Film Adı:</label>
                <input type="text" class="form-control" id="newTitle" name="newTitle">
            </div>
            <div class="form-group">
                <label for="newBackgroundImageUrl">Background Resmi URL:</label>
                <input type="text" class="form-control" id="newBackgroundImageUrl" name="newBackgroundImageUrl">
            </div>
            <div class="form-group">
                <label for="newPosterImageUrl">Poster Resmi URL:</label>
                <input type="text" class="form-control" id="newPosterImageUrl" name="newPosterImageUrl">
            </div>
            <div class="form-group">
                <label for="newDuration">Uzunluk:</label>
                <input type="text" class="form-control" id="newDuration" name="newDuration">
            </div>
            <div class="form-group">
                <label for="newImdbRating">IMDb Puanı:</label>
                <input type="text" class="form-control" id="newImdbRating" name="newImdbRating">
            </div>
            <div class="form-group">
                <label for="newReleaseYear">Çıkış Yılı:</label>
                <input type="text" class="form-control" id="newReleaseYear" name="newReleaseYear">
            </div>
            <div class="form-group">
                <label for="newUrl">Video URL:</label>
                <input type="text" class="form-control" id="newUrl" name="newUrl">
            </div>
            <div class="form-group">
                <label>Kategoriler:</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryAile" name="categories" value="Aile">
                    <label class="form-check-label" for="categoryAile">Aile</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryAksiyon" name="categories"
                        value="Aksiyon">
                    <label class="form-check-label" for="categoryAksiyon">Aksiyon</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryAnimasyon" name="categories"
                        value="Animasyon">
                    <label class="form-check-label" for="categoryAnimasyon">Animasyon</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryBilimKurgu" name="categories"
                        value="Bilim Kurgu">
                    <label class="form-check-label" for="categoryBilimKurgu">Bilim Kurgu</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryBiyografi" name="categories"
                        value="Biyografi">
                    <label class="form-check-label" for="categoryBiyografi">Biyografi</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryCocuk" name="categories" value="Çocuk">
                    <label class="form-check-label" for="categoryCocuk">Çocuk</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryDram" name="categories" value="Dram">
                    <label class="form-check-label" for="categoryDram">Dram</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryFantastik" name="categories"
                        value="Fantastik">
                    <label class="form-check-label" for="categoryFantastik">Fantastik</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryGerilim" name="categories"
                        value="Gerilim">
                    <label class="form-check-label" for="categoryGerilim">Gerilim</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryGizem" name="categories" value="Gizem">
                    <label class="form-check-label" for="categoryGizem">Gizem</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryKomedi" name="categories"
                        value="Komedi">
                    <label class="form-check-label" for="categoryKomedi">Komedi</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryKorku" name="categories" value="Korku">
                    <label class="form-check-label" for="categoryKorku">Korku</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryMacera" name="categories"
                        value="Macera">
                    <label class="form-check-label" for="categoryMacera">Macera</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryMuzikal" name="categories"
                        value="Müzikal">
                    <label class="form-check-label" for="categoryMuzikal">Müzikal</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryPolisiye" name="categories"
                        value="Polisiye">
                    <label class="form-check-label" for="categoryPolisiye">Polisiye</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryPsikoloji" name="categories"
                        value="Psikoloji">
                    <label class="form-check-label" for="categoryPsikoloji">Psikoloji</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categoryRomantik" name="categories"
                        value="Romantik">
                    <label class="form-check-label" for="categoryRomantik">Romantik</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categorySavas" name="categories" value="Savaş">
                    <label class="form-check-label" for="categorySavas">Savaş</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categorySpor" name="categories" value="Spor">
                    <label class="form-check-label" for="categorySpor">Spor</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="categorySuc" name="categories" value="Suç">
                    <label class="form-check-label" for="categorySuc">Suç</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Ekle</button>
            <p id="successMessage" style="display: none; color: green; font-size: 1.2em;"></p>
        </form>
    </div>

    <!-- Include necessary JavaScript libraries -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Include Bootstrap and other libraries -->
    <!-- Include Firebase SDK and your Firebase configuration file -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script>
        // Function to get the next movieId
        function getNextMovieId() {
            return firebase.firestore().collection("movies")
                .orderBy("movieId", "desc")
                .limit(1)
                .get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        const highestMovieId = querySnapshot.docs[0].data().movieId;
                        return highestMovieId + 1;
                    } else {
                        return 1; // Start from 1 if no movies exist
                    }
                })
                .catch((error) => {
                    console.error("Error getting documents: ", error);
                });
        }

        // Automatically set and disable movieId input field
        getNextMovieId().then((nextId) => {
            document.getElementById("newMovieId").value = nextId;
            document.getElementById("newMovieId").readOnly = true;
        });

        // JavaScript for adding new movies to Firestore
        document.getElementById("addMovieForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent the default form submission

            const currentDate = new Date();
            const timestamp = firebase.firestore.Timestamp.fromDate(currentDate);

            const newMovieData = {
                // ... (other movie data properties)
                movieId: parseInt(document.getElementById("newMovieId").value), // Get from input, no edit allowed
                title: document.getElementById("newTitle").value,
                backgroundImageUrl: document.getElementById("newBackgroundImageUrl").value,
                posterImageUrl: document.getElementById("newPosterImageUrl").value,
                duration: document.getElementById("newDuration").value,
                imdbRating: document.getElementById("newImdbRating").value,
                releaseYear: document.getElementById("newReleaseYear").value,
                url: document.getElementById("newUrl").value,
                timestamp: timestamp,
                categories: [], // Create an array to store selected categories
            };

            // Retrieve selected categories
            const categories = document.getElementsByName("categories");
            const selectedCategories = Array.from(categories).filter(category => category.checked);

            // Extract values of checked categories and add to newMovieData
            selectedCategories.forEach(category => {
                newMovieData.categories.push(category.value);
            });

            // Store new movie data in Firestore
            firebase.firestore().collection("movies").add(newMovieData)
                .then(() => {
                    const successParagraph = document.getElementById("successMessage");
                    successParagraph.textContent = "Film Başarıyla Eklendi!";
                    successParagraph.style.display = "block"; // Show the success message


                    window.location.href = "index.html";
                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                });
        });
    </script>


    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

</body>

</html>